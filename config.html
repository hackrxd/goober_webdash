<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script>
            (function(){
                try{
                    var isMobile = /Mobi|Android|iPhone|iPad|iPod|Windows Phone/.test(navigator.userAgent) || (screen.width && screen.width < 720);
                    if(isMobile) document.documentElement.classList.add('is-mobile');
                }catch(e){/* ignore */}
            })();
        </script>
        <title id="title">Configuration</title>
        <link href="/main.css" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        </head>
        <body>
        <div class="error" id="error"></div>
        <header>
            <h1 id="name-header">Configuration</h1>
        </header>
        <form>
            <main class="container">
                <section class="card" aria-labelledby="config-title">
                    <h2 id="config-title">Configuration</h2>
                    <label for="name">Dashboard Name</label>
                    <input type="text" id="name" name="name" style="width:100%;margin-top:6px;margin-bottom:12px;padding:8px;border-radius:6px;border:1px solid #2a2a2a;background:transparent;color:#fff;">
                    <label for="logLines">Maximum Log Lines</label>
                    <input type="number" id="logLines" name="logLines" min="1000" max="100000" step="1000" value="10000" style="width:100%;margin-top:6px;margin-bottom:12px;padding:8px;border-radius:6px;border:1px solid #2a2a2a;background:transparent;color:#fff;">
                    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px;">
                        <button type="button" id="save-config-btn" style="background:var(--accent);color:#000;padding:8px 12px;border-radius:6px;border:0;">Save Configuration</button>
                    </div>
                    <p id="config-result" style="margin-top:12px;color:#9ca3af;font-size:13px;display:none"></p>
                </section>
            </main>
        </form>
        </body>
        <!--submission script-->
        <script>
            document.getElementById('save-config-btn').addEventListener('click', function () {
                const name = document.getElementById('name').value.trim();
                const logLines = parseInt(document.getElementById('logLines').value);
                const result = document.getElementById('config-result');

                fetch('/config/edit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                        body: JSON.stringify({ name: name, logLines: logLines })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        result.style.display = 'block';
                        result.style.color = '#34d399'; // green
                        result.innerText = 'Configuration saved successfully.';
                        location.href = '/';
                    } else {
                        result.style.display = 'block';
                        result.style.color = '#f87171'; // red
                        result.innerText = 'Error saving configuration: ' + data.error;
                        location.href = '/';
                    }
                })
                .catch(error => {
                    result.style.display = 'block';
                    result.style.color = '#f87171'; // red
                    result.innerText = 'Error saving configuration: ' + error.message;
                    location.href = '/';
                });
            });
            
        </script>
        <script src="/loadconfig.js"></script>
</html>